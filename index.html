<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>G.maYou7Tb</title>
<style>
    body {
        background: #f3e6d0;
        font-family: Arial, sans-serif;
        padding: 20px;
        color: #5a4633;
    }
    h1 {
        text-align: center;
        color: #5a4633;
    }
    .post {
        background: #fff7ea;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 12px;
        border: 1px solid #dec7a8;
        position: relative;
    }
    .edited {
        position: absolute;
        top: 5px;
        right: 10px;
        font-size: 12px;
        opacity: 0.5;
    }
    #editorPanel {
        display: none;
        margin-bottom: 20px;
        background: #fff0d9;
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #d9c1a3;
    }
    .btn {
        padding: 8px 12px;
        background: #d5b893;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 5px;
    }
    .reaction {
        margin-top: 10px;
        font-size: 15px;
    }
    .reaction span {
        cursor: pointer;
        margin-right: 20px;
        user-select: none;
    }
    #modeBtn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #d5b893;
        padding: 10px 15px;
        border-radius: 10px;
        cursor: pointer;
        border: none;
    }
</style>
</head>
<body>

<h1>G.maYou7Tb</h1>

<div id="posts"></div>

<div id="editorPanel">
    <textarea id="postText" cols="40" rows="5" placeholder="–¢–µ–∫—Å—Ç..."></textarea><br>
    <input type="datetime-local" id="postTime"><br>
    <button class="btn" onclick="addPost()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
</div>

<button id="modeBtn" onclick="toggleMode()">–ó—Ä–∏—Ç–µ–ª—å</button>

<script>
/* ----------------------------------------------------
  G.maYou7Tb
   ---------------------------------------------------- */

const OWNER_KEY = "__MY_SITE_OWNER__";

// !34!HnK(
if (!localStorage.getItem(OWNER_KEY)) {
    localStorage.setItem(OWNER_KEY, crypto.randomUUID());
}

// 
function isOwner() {
    return localStorage.getItem(OWNER_KEY) !== null;
}

// 
let creatorMode = localStorage.getItem("creatorMode") === "1";

function updateInterface() {
    if (isOwner() && creatorMode) {
        document.getElementById("editorPanel").style.display = "block";
        document.getElementById("modeBtn").innerText = "–°–æ–∑–¥–∞—Ç–µ–ª—å";
    } else {
        document.getElementById("editorPanel").style.display = "none";
        document.getElementById("modeBtn").innerText = "–ó—Ä–∏—Ç–µ–ª—å";
    }
}

function toggleMode() {
    if (!isOwner()) return;
    creatorMode = !creatorMode;
    localStorage.setItem("creatorMode", creatorMode ? "1" : "0");
    updateInterface();
    renderPosts();
}

updateInterface();

/*  */

function addPost() {
    let text = document.getElementById("postText").value;
    let time = document.getElementById("postTime").value;

    if (!text.trim()) return;

    let id = Date.now();
    let timeStr = time ? new Date(time).toLocaleString() : new Date().toLocaleString();

    let post = {
        id: id,
        text: text,
        time: timeStr,
        edited: false,
        likes: 0,
        dislikes: 0
    };

    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    posts.unshift(post);
    localStorage.setItem("posts", JSON.stringify(posts));

    document.getElementById("postText").value = "";
    renderPosts();
}

function editPost(id) {
    if (!(isOwner() && creatorMode)) return;

    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    let post = posts.find(p => p.id === id);

    let newText = prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç:", post.text);
    if (newText === null) return;

    post.text = newText;
    post.edited = true;

    localStorage.setItem("posts", JSON.stringify(posts));
    renderPosts();
}

function react(id, type) {
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    let post = posts.find(p => p.id === id);

    let votes = JSON.parse(localStorage.getItem("votes") || "{}");
    if (votes[id] === type) return;

    // –ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫
    if (type === "like") {
        post.likes++;
        if (votes[id] === "dislike") post.dislikes--;
    } else {
        post.dislikes++;
        if (votes[id] === "like") post.likes--;
    }

    votes[id] = type;

    localStorage.setItem("votes", JSON.stringify(votes));
    localStorage.setItem("posts", JSON.stringify(posts));

    renderPosts();
}

function renderPosts() {
    let posts = JSON.parse(localStorage.getItem("posts") || "[]");
    let box = document.getElementById("posts");
    box.innerHTML = "";

    posts.forEach(p => {
        let div = document.createElement("div");
        div.className = "post";

        let html = `
            <b>${p.time}</b><br><br>
            ${p.text.replace(/\n/g, "<br>")}
        `;

        if (p.edited) {
            html += `<div class="edited">–ò–∑–º–µ–Ω–µ–Ω–æ</div>`;
        }

        if (isOwner() && creatorMode) {
            html += `<br><button class="btn" onclick="editPost(${p.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>`;
        }

        html += `
            <div class="reaction">
                <span onclick="react(${p.id}, 'like')">üëç ${p.likes}</span>
                <span onclick="react(${p.id}, 'dislike')">üëé ${p.dislikes}</span>
            </div>
        `;

        div.innerHTML = html;
        box.appendChild(div);
    });
}

renderPosts();
</script>

</body>

</html>
