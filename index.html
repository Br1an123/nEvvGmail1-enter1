<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ú–æ–π —Å–∞–π—Ç</title>
<style>
  body { background: #f5f0e1; font-family: Arial, sans-serif; margin:0; padding:10px;}
  #editor { display:none; padding:10px; background:#fff3e0; margin-bottom:10px; border-radius:5px; }
  #editor textarea { width:100%; resize:none; }
  #posts { margin:0; }
  .post { background:#fff; padding:6px 8px; margin-bottom:6px; border-radius:4px; position:relative; line-height:1.2; }
  .edited { opacity:0.6; font-size:12px; position:absolute; right:5px; top:5px; }
  .like, .dislike { cursor:pointer; margin-left:5px; font-size:14px; user-select:none; }
  #secretZone { position:fixed; width:20px; height:20px; right:5px; top:5px; opacity:0; z-index:9999; }
</style>
</head>
<body>

<div id="secretZone"></div>

<div id="editor">
  <textarea id="newPost" rows="3" placeholder="–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç..."></textarea>
  <button id="addPost">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>

<div id="posts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// --- –¢–≤–æ–π Firebase –∫–æ–Ω—Ñ–∏–≥ ---
const firebaseConfig = {
  apiKey: "AIzaSyAOJwSqrNzMDJe5CuX7ZRtwZy-0gnbIkPQ",
  authDomain: "nevv1you7yb.firebaseapp.com",
  projectId: "nevv1you7yb",
  storageBucket: "nevv1you7yb.firebasestorage.app",
  messagingSenderId: "378007403400",
  appId: "1:378007403400:web:004fc218eb0c57cac4583d",
  measurementId: "G-NW5NPWMZ8Q"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const creatorEmail = "maps50876@gmail.com"; // –¢–æ–ª—å–∫–æ —Ç–≤–æ–π email –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å
let isAuthor = false;

// --- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∑–æ–Ω–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ—Ä–∞ ---
let clicks=0,timer=null;
document.getElementById("secretZone").addEventListener("click", ()=>{
  clicks++;
  if(timer) clearTimeout(timer);
  timer=setTimeout(()=>{clicks=0; timer=null;},3000);
  if(clicks>=5){
    clicks=0;
    loginCreator();
  }
});

// --- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ---
async function loginCreator() {
  const password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:");
  try {
    const userCredential = await signInWithEmailAndPassword(auth, creatorEmail, password);
    if(userCredential.user.email === creatorEmail){
      isAuthor = true;
      document.getElementById("editor").style.display = "block";
      alert("–†–µ–∂–∏–º –∞–≤—Ç–æ—Ä–∞ –≤–∫–ª—é—á—ë–Ω!");
    }
  } catch(e) {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ email");
  }
}

// --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ ---
document.getElementById("addPost").addEventListener("click", async ()=>{
  const text = document.getElementById("newPost").value.trim();
  if(text && isAuthor){
    await addDoc(collection(db,"posts"),{
      text:text,
      created:Date.now(),
      edited:false,
      likes:0,
      dislikes:0
    });
    document.getElementById("newPost").value="";
  }
});

// --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ ---
const postsDiv = document.getElementById("posts");
onSnapshot(collection(db,"posts"), (snapshot)=>{
  postsDiv.innerHTML="";
  snapshot.docs.sort((a,b)=>b.data().created - a.data().created).forEach(docSnap=>{
    const data = docSnap.data();
    const postId = docSnap.id;
    const postEl = document.createElement("div");
    postEl.className="post";
    postEl.innerHTML=`<div>${data.text}</div>
      ${data.edited ? '<div class="edited">–ò–∑–º–µ–Ω–µ–Ω–æ</div>':""}
      <span class="like">üëç ${data.likes||0}</span>
      <span class="dislike">üëé ${data.dislikes||0}</span>
    `;

    // --- –õ–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ---
    const likedKey = 'liked_'+postId;
    const dislikedKey = 'disliked_'+postId;

    postEl.querySelector(".like").addEventListener("click", async ()=>{
      if(!localStorage.getItem(likedKey)){
        await updateDoc(doc(db,"posts",postId),{likes:(data.likes||0)+1});
        localStorage.setItem(likedKey,'1');
      }
    });

    postEl.querySelector(".dislike").addEventListener("click", async ()=>{
      if(!localStorage.getItem(dislikedKey)){
        await updateDoc(doc(db,"posts",postId),{dislikes:(data.dislikes||0)+1});
        localStorage.setItem(dislikedKey,'1');
      }
    });

    postsDiv.appendChild(postEl);
  });
});
</script>
</body>
</html>
