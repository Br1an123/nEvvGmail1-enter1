<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title> You7Tb</title>
<style>
body {
  background: #f5f0e1;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#editor {
  display: none;
  padding: 10px;
  background: #fff3e0;
  margin-bottom: 15px;
  border-radius: 5px;
  width: 100%;
  max-width: 600px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

#editor textarea {
  width: 100%;
  resize: none;
  font-size: 14px;
  border-radius: 4px;
  border: 1px solid #ddd;
  padding: 5px;
}

#posts {
  width: 100%;
  max-width: 600px;
}

.post {
  background: #fff;
  padding: 8px 12px;
  margin-bottom: 6px;
  border-radius: 6px;
  position: relative;
  line-height: 1.4;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  word-wrap: break-word;
}

.edited {
  opacity: 0.6;
  font-size: 12px;
  position: absolute;
  right: 5px;
  top: 5px;
}

.like, .dislike, .editBtn, .timeBtn, .deleteBtn {
  cursor: pointer;
  margin-left: 5px;
  font-size: 14px;
}

#secretBtn {
  position: fixed;
  top: 5px;
  right: 5px;
  width: 20px;
  height: 20px;
  opacity: 0.05;
  z-index: 9999;
  cursor: pointer;
}
</style>
</head>
<body>

<!-- –ú–∏–Ω–∏ –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ—Ä–∞ -->
<div id="secretBtn" title="–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞"></div>

<div id="editor">
  <textarea id="newPost" rows="2" placeholder="–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç..."></textarea>
  <button id="addPost">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>

<div id="posts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyAOJwSqrNzMDJe5CuX7ZRtwZy-0gnbIkPQ",
  authDomain: "nevv1you7yb.firebaseapp.com",
  projectId: "nevv1you7yb",
  storageBucket: "nevv1you7yb.firebasestorage.app",
  messagingSenderId: "378007403400",
  appId: "1:378007403400:web:004fc218eb0c57cac4583d",
  measurementId: "G-NW5NPWMZ8Q"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const creatorEmail = "maps50876@gmail.com"; // Email –∞–≤—Ç–æ—Ä–∞
let isAuthor = false;

// --- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ (5 –∫–ª–∏–∫–æ–≤) ---
let clicks = 0, timer = null;
document.getElementById("secretBtn").addEventListener("click", () => {
  clicks++;
  if(timer) clearTimeout(timer);
  timer = setTimeout(() => { clicks = 0; timer = null; }, 3000);
  if(clicks >= 5) {
    clicks = 0;
    loginCreator();
  }
});

// --- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ---
async function loginCreator() {
  const password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:");
  try {
    const userCredential = await signInWithEmailAndPassword(auth, creatorEmail, password);
    if(userCredential.user.email === creatorEmail){
      isAuthor = true;
      document.getElementById("editor").style.display = "block";
      alert("–†–µ–∂–∏–º –∞–≤—Ç–æ—Ä–∞ –≤–∫–ª—é—á—ë–Ω!");
    }
  } catch(e) {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ email");
  }
}

// --- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ ---
document.getElementById("addPost").addEventListener("click", async () => {
  const text = document.getElementById("newPost").value.trim();
  if(text && isAuthor){
    await addDoc(collection(db,"posts"),{
      text:text,
      created:Date.now(),
      edited:false,
      likes:0,
      dislikes:0
    });
    document.getElementById("newPost").value="";
  }
});

// --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ ---
const postsDiv = document.getElementById("posts");

onSnapshot(collection(db,"posts"), snapshot => {
  postsDiv.innerHTML = "";
  snapshot.docs.sort((a,b) => b.data().created - a.data().created).forEach(docSnap => {
    const data = docSnap.data();
    const postId = docSnap.id;
    const postEl = document.createElement("div");
    postEl.className = "post";
    postEl.innerHTML = `
      <div>${data.text}</div>
      ${data.edited ? '<div class="edited">–ò–∑–º–µ–Ω–µ–Ω–æ</div>' : ""}
      <span class="like">üëç ${data.likes||0}</span>
      <span class="dislike">üëé ${data.dislikes||0}</span>
      ${isAuthor ? '<span class="editBtn">‚úèÔ∏è</span><span class="timeBtn">üïí</span><span class="deleteBtn">üóëÔ∏è</span>' : ''}
    `;

    // --- –õ–∞–π–∫ / –¥–∏–∑–ª–∞–π–∫ 
    postEl.querySelector(".like").addEventListener("click", async ()=>{
      let vote = JSON.parse(localStorage.getItem(postId)) || 'none';
      if(vote === 'like'){
        await updateDoc(doc(db,"posts",postId), {likes:(data.likes||0)-1});
        localStorage.setItem(postId, JSON.stringify('none'));
      } else if(vote === 'dislike'){
        await updateDoc(doc(db,"posts",postId), {likes:(data.likes||0)+1, dislikes:(data.dislikes||0)-1});
        localStorage.setItem(postId, JSON.stringify('like'));
      } else {
        await updateDoc(doc(db,"posts",postId), {likes:(data.likes||0)+1});
        localStorage.setItem(postId, JSON.stringify('like'));
      }
    });

    postEl.querySelector(".dislike").addEventListener("click", async ()=>{
      let vote = JSON.parse(localStorage.getItem(postId)) || 'none';
      if(vote === 'dislike'){
        await updateDoc(doc(db,"posts",postId), {dislikes:(data.dislikes||0)-1});
        localStorage.setItem(postId, JSON.stringify('none'));
      } else if(vote === 'like'){
        await updateDoc(doc(db,"posts",postId), {likes:(data.likes||0)-1, dislikes:(data.dislikes||0)+1});
        localStorage.setItem(postId, JSON.stringify('dislike'));
      } else {
        await updateDoc(doc(db,"posts",postId), {dislikes:(data.dislikes||0)+1});
        localStorage.setItem(postId, JSON.stringify('dislike'));
      }
    });

    // --- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ ---
    if(isAuthor && postEl.querySelector(".editBtn")){
      postEl.querySelector(".editBtn").addEventListener("click", async ()=>{
        const newText = prompt("–ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç:", data.text);
        if(newText !== null){
          await updateDoc(doc(db,"posts",postId), {text:newText, edited:true});
        }
      });
    }

    // --- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ ---
    if(isAuthor && postEl.querySelector(".timeBtn")){
      postEl.querySelector(".timeBtn").addEventListener("click", async ()=>{
        const newTime = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (timestamp –≤ ms):", data.created);
        const timeValue = parseInt(newTime);
        if(!isNaN(timeValue)){
          await updateDoc(doc(db,"posts",postId), {created: timeValue});
        }
      });
    }

    // --- –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ ---
    if(isAuthor && postEl.querySelector(".deleteBtn")){
      postEl.querySelector(".deleteBtn").addEventListener("click", async ()=>{
        if(confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?")){
          await deleteDoc(doc(db,"posts",postId));
        }
      });
    }

    postsDiv.appendChild(postEl);
  });
});
</script>

</body>
</html>

